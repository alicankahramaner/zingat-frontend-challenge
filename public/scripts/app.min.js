var App={Init:function(){App.Helper.Import(this)},Helper:{Import:function(e){var t;for(t in e)if(e.hasOwnProperty(t)){var i=e[t];void 0!==i.selector&&void 0!==i.init&&document.querySelectorAll(i.selector).length&&i.init()}},isMobile:()=>window.innerWidth<960,Http:(()=>{var e=new XMLHttpRequest,t=document.getElementById("loading"),i=async(i="POST",l="",a={},s=Function)=>new Promise((s,r)=>{t.classList.toggle("show"),e.open("POST",l,!0),"POST"===i&&e.setRequestHeader("Content-Type","application/json"),e.onreadystatechange=function(){4==this.readyState&&200==this.status&&(t.classList.toggle("show"),s(JSON.parse(e.responseText)))},e.onerror=r,e.send(JSON.stringify(a))});return{post:async(e="",t={})=>await i("POST",e,t),get:async(e="",t={})=>await i("GET",e,t)}})()},Login:{selector:".login-form",init(){var e=document.querySelector(this.selector);e.addEventListener("submit",async function(t){t.preventDefault();var i={username:e.elements.username.value,password:e.elements.password.value};if(""===i.username||""===i.password)return void alert("Lütfen bütün alanları doldurunuz.");(await App.Helper.Http.post("/login",i)).success?location.href="/myalbums":alert("Hatalı kullanıcı adı veya şifre")})}},MyAlbums:{selector:"#myalbums",albumLinkList:document.getElementById("albumList"),albumImages:document.getElementById("albumImages"),previewAlbumImage:previewAlbumImage=document.getElementById("previewAlbumImage"),init(){this.getAlbumList()},async getAlbumList(){let e=await App.Helper.Http.post("/myalbums",{size:10});e.success?this.fillAlbumList(e.data):alert("Albümler getirilemedi tekrar deneyiniz.")},fillAlbumList(e=[]){for(var t=0;t<e.length;t++){let i=e[t],l=document.createElement("a");l.text=i.title,l.href="javascript:;",l.onclick=(e=>{this.getAlbumDetail(e,i.id)}),this.albumLinkList.appendChild(l)}},async getAlbumDetail(e,t=0){if(0===t)return;let i=this.previewAlbumImage.querySelector("img");i&&this.previewAlbumImage.removeChild(i);let l=this.albumLinkList.querySelector(".active");l&&l.classList.remove("active"),e.target.classList.add("active");let a=await App.Helper.Http.post("/getAlbum",{albumId:t,size:App.Helper.isMobile()?4:8});a.success?this.fillAlbumImage(a.data):alert("Bir hata oluştu lütfen tekrar deneyiniz.")},fillAlbumImage(e=[]){this.albumImages.innerHTML="",e.forEach(e=>{let t=document.createElement("img");t.src=e.thumbnailUrl,t.alt=e.title,t.dataset.fullsize=e.url,t.onclick=(t=>{this.getAlbumPhotoFullSize(t.target,e.url)}),this.albumImages.appendChild(t)})},getAlbumPhotoFullSize(e,t=""){if(""===t)return;let i=this.albumImages.querySelector(".active");console.log("active img",i),i&&i.classList.remove("active"),e.classList.add("active");let l=this.previewAlbumImage.querySelector("img");l||(l=document.createElement("img"),this.previewAlbumImage.appendChild(l)),l.src=t}}};window.addEventListener("load",()=>{App.Init()});